services:
  django:
    build:
      dockerfile: dev.Dockerfile
    volumes:
    - type: bind
      source: ./backend
      target: /code/backend

  nginx:
    build:
      dockerfile: dev.Dockerfile
    volumes:
      - type: bind
        source: ./build/development
        target: /code/build/development
    depends_on:
      - webpack
    ports:
      - 8000:8000

  webpack:
    build:
      context: ./frontend
      dockerfile: dev.Dockerfile
    volumes:
      - type: bind
        source: ./frontend
        target: /code/frontend

      # Create a data volume to prevent node_modules from being overwritten
      - node_modules:/code/frontend/node_modules

      - type: bind
        source: ./build/development
        target: /code/build/development

volumes:
  node_modules: